<% provide(:title, 'Reservetion') %>

  <h1>Scheduler</h1>

  <div class="row">
    <div class='col-sm-6'>
      <%=form_tag('/reservation', method: :get) do%>
          <div class="form-group">
            <div class='input-group date' id='datetimepicker1'>
                <input type='text' class="form-control" name="start_date" data-date-format="YYYY-MM-DD HH:mm Z"/>
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
            <%= submit_tag "Select Date" %>
          </div>
          
      <% end %>
    </div>
  </div>
  
  <div class = "row">
    <div class="col-sm-4">
      <div class="panel panel-default">
        <div class="panel-body">
          <span class="glyphicon glyphicon-lock"> : Reserved Timeslots</span>
        </div>
      </div>
    </div>
  </div>

  <div class = "row">
    <div class = "col-lg-12">    
      <section class = "panel ">
        <%if @date == Date.today.to_s %>
          <header class="panel-heading"> Reservation table for the next 24 hours</header>
        <%else%>
          <header class="panel-heading"> Reservation table for <%=@date%></header>
        <%end%>
        <div class = "panel-body">

          <div class="table-responsive">

            <%=form_tag make_reservation_path do%>
              <%= select_tag(:user_slice, options_for_select(@user_slices)) %>

              <table class="table table-bordered table-striped">

                <tr>
                  <td></td>
                  <%@reservation_table[0].each_key do |key|%>
                    <td><%=key.split(" ")[1]%></td>
                  <%end%>
                </tr>

                <%@reservation_table.each do |iterate|%>
                  <tr title = "<%=iterate.values[0]%>">

                    <td  >
                      <img src="images/details_open.png" data-toggle="collapse" data-target="#details_for_<%=iterate.values[0]%>" id = "img_details_for_<%=iterate.values[0]%>" class ="button-node-details">
                      
                    </td>

                    <%iterate.each do |key, value|%>  
                      <%if key == "Name"%>
                        <td>
                          <%=value%>                  
                        </td>
                      <%else%>  
                        <%if value == 1%>        
                          <td>
                            <span class = "glyphicon glyphicon-lock"></span>                             
                          </td>
                        <%else%>
                          <td class = "td-checkbox">
                            <%timh = iterate.values[0]+"/"+key %>
                            <%=check_box_tag "reservations[]",iterate.values[0]+"/"+key,false, :class => "regular-checkbox big-checkbox",:id => timh%>
                            <label for="<%=timh%>"></label>                      
                          </td>
                        <%end%>
                      <%end%>
                    <%end%>
                  </tr>

                  <tr class = "collapse" id = "details_for_<%=iterate.values[0]%>">
                    <td colspan="50">
                      <p>Deatails for node <%=iterate.values[0]%></p>
                      <ul>
                        <li>hardware_type:  <%=@details_of_nodes[iterate.values[0]]["hardware_type"]%></li>
                        <li>domain:         <%=@details_of_nodes[iterate.values[0]]["domain"]%></li>
                        <li>cpu_type:       <%=@details_of_nodes[iterate.values[0]]["cpu"]["cpu_type"]%></li>
                        <li>ram:            <%=@details_of_nodes[iterate.values[0]]["ram"]%></li>
                        <li>hd_capacity     <%=@details_of_nodes[iterate.values[0]]["hd_capacity"]%></li>
                        <li>
                          interfaces:     <ul><%@details_of_nodes[iterate.values[0]]["interfaces"].each do |interface| %>
                                                <li><%=interface["name"]%></li>
                                              <%end%>
                                          </ul>
                        </li>
                      </ul>
                      
                    </td>
                  </tr>

                <%end%>
              </table>
              <%= submit_tag "Make reservations" %>
            <% end %>
          </div>
        </div>
      </section>
    </div>
  </div>


<script type="text/javascript">
  $(function () {
    var today = moment();
    $('#datetimepicker1').datetimepicker({
      minDate: today,
      pickTime: false
    });
  });
</script>

<script>
  $('.button-node-details').click(function(){
    var id = this.id;
    if($("#"+id).attr("src") == "images/details_open.png"){
      $("#"+id).attr("src", "images/details_close.png");
    }else{
      $("#"+id).attr("src", "images/details_open.png");
    }
  });
  
</script>
